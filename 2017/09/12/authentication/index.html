<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>SSH 无密码登录及 putty 设置 | AppSo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="生成公钥和私钥Linux 系统中绝大部分的发行版都是用 OpenSSH，所以生成公钥私钥的时候最好用 ssh-keygen 命令，如果用 putty 自带的 PUTTYGEN.EXE 生成会不兼容 OpenSSH，从而会导致登录时出现 server refused our key 错误。 用 root 登录后运行命令如下。">
<meta property="og:type" content="article">
<meta property="og:title" content="SSH 无密码登录及 putty 设置">
<meta property="og:url" content="http://yoursite.com/2017/09/12/authentication/index.html">
<meta property="og:site_name" content="AppSo">
<meta property="og:description" content="生成公钥和私钥Linux 系统中绝大部分的发行版都是用 OpenSSH，所以生成公钥私钥的时候最好用 ssh-keygen 命令，如果用 putty 自带的 PUTTYGEN.EXE 生成会不兼容 OpenSSH，从而会导致登录时出现 server refused our key 错误。 用 root 登录后运行命令如下。">
<meta property="og:image" content="http://yoursite.com/images/keygen_1.png">
<meta property="og:image" content="http://yoursite.com/images/keygen_2.png">
<meta property="og:updated_time" content="2017-09-12T08:42:23.849Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SSH 无密码登录及 putty 设置">
<meta name="twitter:description" content="生成公钥和私钥Linux 系统中绝大部分的发行版都是用 OpenSSH，所以生成公钥私钥的时候最好用 ssh-keygen 命令，如果用 putty 自带的 PUTTYGEN.EXE 生成会不兼容 OpenSSH，从而会导致登录时出现 server refused our key 错误。 用 root 登录后运行命令如下。">
<meta name="twitter:image" content="http://yoursite.com/images/keygen_1.png">
  
    <link rel="alternative" href="/atom.xml" title="AppSo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <div class="outer">
        <section id="main"><article id="post-authentication" class="article article-type-post" itemscope itemprop="blogPost">
  
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      SSH 无密码登录及 putty 设置
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/09/12/authentication/" class="article-date">
  <time datetime="2017-09-11T21:14:01.000Z" itemprop="datePublished">2017-09-12</time>
</a>
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="生成公钥和私钥"><a href="#生成公钥和私钥" class="headerlink" title="生成公钥和私钥"></a>生成公钥和私钥</h3><p>Linux 系统中绝大部分的发行版都是用 OpenSSH，所以生成公钥私钥的时候最好用 <code>ssh-keygen</code> 命令，如果用 putty 自带的 PUTTYGEN.EXE 生成会不兼容 OpenSSH，从而会导致登录时出现 <code>server refused our key</code> 错误。</p>
<p>用 root 登录后运行命令如下。</p>
<a id="more"></a>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa</div><div class="line">Generating public/private rsa key pair.</div><div class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):    <span class="comment">##直接回车默认路径</span></div><div class="line">Created directory <span class="string">'/root/.ssh'</span>.</div><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):                 <span class="comment">##输入密码短语（留空则直接回车）</span></div><div class="line">Enter same passphrase again:                                <span class="comment">##重复密码短语</span></div><div class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</div><div class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</div><div class="line">The key fingerprint is:</div><div class="line">04:e1:93:92:95:ba:55:21:58:05:7d:57:58:92:32:d3 root@vpn</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line"><span class="string">+--[ RSA 2048]----+</span></div><div class="line"><span class="string">|     oB*o. ..=o  |</span></div><div class="line"><span class="string">|    .+.+o = E.   |</span></div><div class="line"><span class="string">|    o.+... =     |</span></div><div class="line"><span class="string">|    ...o         |</span></div><div class="line"><span class="string">|     o  S        |</span></div><div class="line"><span class="string">|    .            |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">+-----------------+</span></div></pre></td></tr></table></figure>
<p>在 <code>/root/.ssh/</code> 目录下生成了2个文件，<code>id_rsa</code> 为私钥，<code>id_rsa.pub</code> 为公钥。私钥自己下载到本地电脑妥善保存，公钥则可以任意公开。</p>
<h3 id="导入公钥"><a href="#导入公钥" class="headerlink" title="导入公钥"></a>导入公钥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /root/.ssh/id_rsa.pub &gt;&gt;  /root/.ssh/authorized_keys</div></pre></td></tr></table></figure>
<h3 id="更改-SSH-配置文件"><a href="#更改-SSH-配置文件" class="headerlink" title="更改 SSH 配置文件"></a>更改 SSH 配置文件</h3><p>修改 SSH 的配置文件 <code>/etc/ssh/sshd_config</code>，找到下面3行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#RSAAuthentication yes</span></div><div class="line"><span class="comment">#PubkeyAuthentication yes</span></div><div class="line"><span class="comment">#AuthorizedKeysFile	.ssh/authorized_keys</span></div></pre></td></tr></table></figure>
<p>将前面的 # 去掉后保存。找到下面：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PasswordAuthentication yes</div></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PasswordAuthentication no</div></pre></td></tr></table></figure>
<p>重启 SSH 服务，运行命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service sshd restart</div></pre></td></tr></table></figure>
<h3 id="制作用于-putty-的私钥"><a href="#制作用于-putty-的私钥" class="headerlink" title="制作用于 putty 的私钥"></a>制作用于 putty 的私钥</h3><p>使用 WinScp 等工具将 VPS 上的 <code>/root/.ssh/id_rsa</code> 下载到本地，利用 PUTTYGEN.EXE 转换为 putty 用的 ppk 文件。</p>
<p><img src="/images/keygen_1.png" alt=""></p>
<p>点击 File，Load private key，导入 <code>/root/.ssh/id_rsa</code> 文件。成功后的图片如下所示：</p>
<p><img src="/images/keygen_2.png" alt=""></p>
<p>点击 Save private key 按钮，生成一个后缀为 ppk 的文件。这个文件就是已经制作好的用于 putty 无密码登录的密钥了，妥善保存。</p>
<p>至此，就只能用私钥登录到 VPS 了，安全性大大增强。</p>

      

      
        
    </div>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/09/12/block-port-25/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          block-port-25
        
      </div>
    </a>
  
  
    <a href="/2017/09/12/bbr/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">一键安装最新内核并开启 BBR 脚本</div>
    </a>
  
</nav>

  
</article>


</section>
        <aside id="sidebar">
  <nav class="menus">
  	<ul>
  		<li><a href="/"><i class="icon icon-home"></i></a></li>
  		
			<li><a href="/archives"><i class="icon icon-fenlei"></i></a></li>
  		
  		
			<li><a href="/tags"><i class="icon icon-tag"></i></a></li>
  		
  		
  			<li><a href="https://github.com/AppSo" target="_blank"><i class="icon icon-github"></i></a></li>
  		
  	</ul>
  </nav>
  <a id="go-top" href="#"><i class="icon icon-up"></i></a>
</aside>

      </div>
      <footer id="footer">
  
	<div id="footer-info" class="inner">
	  &copy; 2017 AppSo 
	  - Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
	  - Theme <a href="https://github.com/hejianxian/hexo-theme-jane/" target="_blank">Jane</a>
	</div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/tags" class="mobile-nav-link">Tag</a>
  
    <a href="https://github.com/AppSo" class="mobile-nav-link">Github</a>
  
</nav>
    

<script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>