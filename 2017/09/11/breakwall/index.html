<!DOCTYPE html>
<html lang="zh-cn">
  <head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">


<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">

<meta name="theme-color" content="#f8f5ec">
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="翻墙小结"><meta name="google-site-verification" content="UA-108901925-1"><link rel="alternate" href="/atom.xml" title="AppSo"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.11.0">
<link rel="canonical" href="http://yoursite.com/2017/09/11/breakwall/">

<link rel="stylesheet" type="text/css" href="/lib/fancybox/jquery.fancybox.css"><link rel="stylesheet" type="text/css" href="/lib/nprogress/nprogress.min.css">
<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.11.0">


<script>
  window.config = {"leancloud":{"app_id":null,"app_key":null},"toc":true,"fancybox":true,"pjax":true,"latex":false};
</script>

    <title>翻墙小结 - AppSo</title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">AppSo</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"><a href="/">
        <li class="mobile-menu-item">首页
          </li>
      </a><a href="/archives/">
        <li class="mobile-menu-item">归档
          </li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">标签
          </li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">分类
          </li>
      </a><a href="/about/">
        <li class="mobile-menu-item">关于
          </li>
      </a></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">AppSo</a>
</div>

<nav class="site-navbar"><ul id="menu" class="menu"><li class="menu-item">
          <a class="menu-item-link" href="/">
            首页
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            归档
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/tags/">
            标签
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/categories/">
            分类
            </a>
        </li>
      <li class="menu-item">
          <a class="menu-item-link" href="/about/">
            关于
            </a>
        </li>
      </ul></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">翻墙小结
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2017-09-11
        </span></div>
    </header>

    <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">文章目录</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#VPS-服务商的选择"><span class="toc-text">VPS 服务商的选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#科学上网服务端搭建"><span class="toc-text">科学上网服务端搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建-Shadowsocks-libev-服务器"><span class="toc-text">搭建 Shadowsocks-libev 服务器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优化"><span class="toc-text">优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安全"><span class="toc-text">安全</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#客户端的选择"><span class="toc-text">客户端的选择</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MacOS"><span class="toc-text">MacOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Windows"><span class="toc-text">Windows</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux"><span class="toc-text">Linux</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iOS"><span class="toc-text">iOS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Android"><span class="toc-text">Android</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenWRT"><span class="toc-text">OpenWRT</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#写在最后"><span class="toc-text">写在最后</span></a></li></ol>
    </div>
  </div><div class="post-content"><blockquote>
<p>随着我国相关法律条款的日益完善，本自乱象丛生的 <a href="https://en.m.wikipedia.org/wiki/Virtual_private_network" target="_blank" rel="noopener">VPN</a> 市场如今已渐渐被控制，使用传统协议 （<a href="https://en.m.wikipedia.org/wiki/Internet_Key_Exchange" target="_blank" rel="noopener">IKE</a>、<a href="https://en.m.wikipedia.org/wiki/IPsec" target="_blank" rel="noopener">IPSec</a>、<a href="https://en.m.wikipedia.org/wiki/Point-to-Point_Tunneling_Protocol" target="_blank" rel="noopener">PPTP</a> …） 的科学上网方式也变得更加困难；加上第三方服务商的不透明性，不稳定性，使得第三方科学上网的安全性 （如 <a href="https://en.m.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener">MITM</a> …），速度体验让人堪忧…</p>
</blockquote>
<a id="more"></a>

<p><strong>故本文将详细介绍如何创造一个安全快速的个人科学上网服务环境；涉及服务端的选择，搭建、优化、安全性加强和客户端的选择，以达到更好的科学上网体验；适合有一定知识的 Linux 用户和善于使用搜索引擎的小白阅读…</strong></p>
<p><em>（仅供参考，请在法律范围内使用该教程，如有违反法律规定，作者概不负责）</em></p>
<h2 id="VPS-服务商的选择"><a href="#VPS-服务商的选择" class="headerlink" title="VPS 服务商的选择"></a>VPS 服务商的选择</h2><p><a href="https://en.m.wikipedia.org/wiki/Virtual_private_server" target="_blank" rel="noopener">VPS</a> 服务商的选择将直接影响你的科学上网体验，下面提供一些参考建议，提供商均安全可靠且有一定知名度；<strong>在获得一个 VPS 实例之前，你可能需要先注册好相关账号并准备一张具有国际支付功能的信用卡 （Visa、MasterCard …）</strong></p>
<ul>
<li><p><strong><a href="https://cloud.google.com/" target="_blank" rel="noopener">Google Cloud Computing Engine</a> （推荐）</strong><br>需要一个 Google 账号，初次注册可以获得300$有效期为一年的使用卷，最低配置使用一年几乎免费；建议选择 Asia 机房 （IP Location：Mountain View），速度和稳定性极佳，但不支持 IPv6 （不使用负载均衡的情况下）</p>
</li>
<li><p><strong><a href="https://aws.amazon.com/" target="_blank" rel="noopener">AWS EC2</a></strong><br>需要一个 Amazon 账号，初次注册可以获得一年的 Free Trial 权限，出入站流量各 15GB/月；建议选择 Tokyo 机房 （IP Location：Tokyo），稳定性极佳，速度尚可，支持 IPv6 （需<strong><a href="http://docs.aws.amazon.com/AmazonVPC/latest/UserGuide/vpc-migrate-ipv6.html" target="_blank" rel="noopener">设置 VPC</a></strong>）</p>
</li>
<li><p><strong><a href="https://vultr.com/" target="_blank" rel="noopener">Vultr</a></strong><br>账号注册简易（可以使用 <a href="https://www.paypal.com/" target="_blank" rel="noopener">PayPal</a> 付款，无需信用卡），初次注册仅送 50GB Block Storage，但费用廉价；建议选择5$套餐，包括 1TB Bandwidth/月，建议选择 Tokyo 机房 （IP Location:：Tokyo），速度一般，稳定性尚可，支持 IPv6</p>
</li>
<li><p><strong><a href="https://linode.com/" target="_blank" rel="noopener">Linode</a></strong><br>账号注册简易，初次注册无优惠，费用廉价，建议选择5$套餐，包括 1TB Bandwidth/月，建议选择 Tokyo 机房 （IP Location：Tokyo），速度极佳，稳定性一般 （由于曾经某些人的滥用，导致 IP 极易被 Ban），支持 IPv6</p>
</li>
<li><p><strong><a href="https://lightsail.aws.amazon.com/" target="_blank" rel="noopener">Lightsail</a></strong><br>需要一个 Amazon 账号，由 AWS 推出，初次注册无优惠，费用廉价配置一般，建议选择5$套餐，包括 500GB Bandwidth/月，建议选择 Tokyo 机房 （IP Location：Tokyo），速度一般，稳定性极佳，不支持 IPv6</p>
</li>
<li><p><strong><a href="https://www.digitalocean.com/" target="_blank" rel="noopener">Digital Ocean</a></strong><br>账号注册简易，初次注册无优惠，费用廉价，建议选择5$套餐，包括 1TB Bandwidth/月，建议选择 Singapore 机房 （IP Location：Singapore），速度一般，稳定性极佳，支持 IPv6</p>
</li>
<li><p><strong><a href="https://azure.microsoft.com/en-us/" target="_blank" rel="noopener">Azure</a></strong><br>需要一个 Microsoft 帐户，初次注册可获得300$有效期为三个月的试用卷；长期使用价格昂贵，建议选择 Japan East/West 机房 （IP Location：Japan），速度和稳定性极佳，支持 IPv6</p>
</li>
</ul>
<p><em>*云服务平台的质量随时都在变化，以上仅供参考</em></p>
<h2 id="科学上网服务端搭建"><a href="#科学上网服务端搭建" class="headerlink" title="科学上网服务端搭建"></a>科学上网服务端搭建</h2><h3 id="搭建-Shadowsocks-libev-服务器"><a href="#搭建-Shadowsocks-libev-服务器" class="headerlink" title="搭建 Shadowsocks-libev 服务器"></a>搭建 Shadowsocks-libev 服务器</h3><p><strong><em>Q1.为什么使用 Shadowsocks 协议？</em></strong></p>
<blockquote>
<p>相比传统的 VPN （IKE、IPSec、PPTP …），Shadowsocks 协议具有更好的灵活性和隐蔽性，且搭建相对简单，因此可以拥有相对传统 VPN 更快的速度和更高的稳定性；另对比 <a href="https://www.v2ray.com/" target="_blank" rel="noopener">V2Ray</a> 这种科学上网的集合体，Shadowsocks 在服务端更加轻量，单一协议完善程度更高；在移动端有更丰富的客户端选择，兼容性和灵活性更优。关于 Shadowsocks 的协议特点，原理及弱点的更多讨论，可以在<strong><a href="https://github.com/breakwa11/shadowsocks-rss/issues/38" title="这里" target="_blank" rel="noopener">这里</a></strong>稍做了解，本文不对此长篇大论</p>
</blockquote>
<p><strong><em>Q2.为什么使用 <a href="https://github.com/shadowsocks/shadowsocks-libev" target="_blank" rel="noopener">Shadowsock-libev</a> 服务端？</em></strong></p>
<blockquote>
<p>相比原版 <a href="https://github.com/shadowsocks/shadowsocks" title="Shadowsocks" target="_blank" rel="noopener">Shadowsocks</a> (Python)，libev (C#) 版本提供了更多的特性支持；而关于<a href="https://github.com/shadowsocksr/shadowsocksr" title="ShadowsocksR" target="_blank" rel="noopener">ShadowsocksR</a> (Python)，Shadowsocks-libev 率先支持 <strong><a href="https://en.m.wikipedia.org/wiki/Authenticated_encryption" title="AEAD" target="_blank" rel="noopener">AEAD</a></strong> 加密，并向 ShadowsocksR 学习引进了 <strong><a href="https://github.com/shadowsocksr/obfsplugin" title="Obfs" target="_blank" rel="noopener">Obfs</a></strong> （<a href="https://github.com/shadowsocks/simple-obfs" title="Simple-Obfs" target="_blank" rel="noopener">Simple-Obfs</a>，但与前者原理有所不同），且提供稳定的周期性更新；关于未来，ShadowsocksR 更倾向于 none 加密策略，而 Shadowsocks-libev 则倾向于传统的加密策略，两者有不同的侧重点 （ShadowsocksR 更侧重消除特征以避免被检测识别，而 Shadowsocks-libev 则追求更高的安全性），综合起来并无优劣之分</p>
</blockquote>
<p>*2017年7月28日，ShadowsocksR团队正式解散</p>
<ol>
<li><p><strong>以 root 权限运行命令</strong></p>
<p>初次连接到实例，一般需要获取 root 权限 （非 root 用户的情况下），获取方法如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br><span class="line"><span class="comment"># 运行以上命令，重设 root 用户密码</span></span><br><span class="line">su</span><br><span class="line"><span class="comment"># 运行以上命令，使用重设后的 root 密码登录</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>开始搭建 Shadowsocks-libev 服务端</strong></p>
<p><strong><a href="https://github.com/shadowsocks/shadowsocks-libev#linux" target="_blank" rel="noopener">自行搭建</a></strong></p>
</li>
<li><p><strong>自定义 Shadowsocks-libev 服务端*</strong></p>
<p>在使用默认的配置<strong>安装完毕后</strong>，对安装后的配置文件进行编辑，编辑命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/shadowsocks-libev/config.json</span><br><span class="line"><span class="comment"># 运行以上命令，对其安装后的运行参数进行编辑自定义（语法为 json 标准格式）</span></span><br></pre></td></tr></table></figure>

<p>参数如下，详见 <strong>[Shadowsocks-libev Wiki]( Shadowsocks-libev Wiki “Shadowsocks-libev Wiki”)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">SSLOCAL=<span class="string">"[\"[::0]\",\"0.0.0.0\"]"</span></span><br><span class="line"><span class="comment"># Shadowsocks 的默认监听地址，默认为任何 IPv6 或 IPv4 地址</span></span><br><span class="line">PORT=<span class="string">"443"</span></span><br><span class="line"><span class="comment"># Shadowsocks 使用的端口，建议使用 443 (HTTPS)</span></span><br><span class="line">LOACL=<span class="string">"127.0.0.1"</span></span><br><span class="line"><span class="comment"># 本地监听地址!</span></span><br><span class="line">LOCALPORT=<span class="string">"1080"</span></span><br><span class="line"><span class="comment"># 本地监听端口!</span></span><br><span class="line">PASSWORD=<span class="string">""</span></span><br><span class="line"><span class="comment"># 加密使用的密码，留空将会自动生成，切忌简单密码</span></span><br><span class="line">DNS=<span class="string">"8.8.8.8"</span></span><br><span class="line"><span class="comment"># 默认使用 Google Public DNS 服务器</span></span><br><span class="line">TIMEOUT=<span class="string">"600"</span></span><br><span class="line"><span class="comment"># 未使用的连接超时自动断开，单位 (s)</span></span><br><span class="line">METHOD=<span class="string">"chacha20-ietf-poly1305"</span></span><br><span class="line"><span class="comment"># 加密方式，详见加密*</span></span><br><span class="line">OBFS=<span class="string">"tls"</span></span><br><span class="line"><span class="comment"># 混淆方式，详见混淆*</span></span><br><span class="line">OBFSHOST=<span class="string">"mzstatic.com"</span></span><br><span class="line"><span class="comment"># 混淆域名，详见混淆*</span></span><br><span class="line">WORKERS=<span class="string">"1024"</span></span><br><span class="line"><span class="comment"># 服务使用的线程数，更高的线程数可以提高加解密速度</span></span><br><span class="line">FWS=<span class="string">"enable"</span></span><br><span class="line"><span class="comment"># 伪装成网站服务器，避免被检测</span></span><br><span class="line">ABB=<span class="string">"enable"</span></span><br><span class="line"><span class="comment"># 利用 fail2ban 自动 Ban 掉向服务器发送恶意数据的 IP</span></span><br><span class="line">BBR=<span class="string">"enable"</span></span><br><span class="line"><span class="comment"># 安装 Google-BBR 加速</span></span><br></pre></td></tr></table></figure>

<p>完成编辑后需<strong>重启 Shadowsocks-libev 应用配置</strong>，命令如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/shadowsocks restart</span><br><span class="line"><span class="comment"># 运行以上命令重启通过 Shadowsocks-libev 服务端</span></span><br></pre></td></tr></table></figure>

<p>*加密，推荐使用 AEAD 加密，以下是四种 AEAD 加密方式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">aes-128-gcm</span><br><span class="line">aes-192-gcm</span><br><span class="line">aes-256-gcm</span><br><span class="line">chacha20-ietf-poly1305</span><br></pre></td></tr></table></figure>

<p>以及几种常用的 OTA 加密方式 （OTA 加密一定程度上可以加快加密速度并降低 CPU 使用率，但较前者安全性更低且有明显缺陷）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rc4-md5</span><br><span class="line">aes-128-cfb</span><br><span class="line">aes-128-ctr</span><br></pre></td></tr></table></figure>

<p>*混淆方式，主要分为 <code>tls</code>、<code>http</code> 两种，相比 <a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol" title="http" target="_blank" rel="noopener">http</a>，<a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" title="tls" target="_blank" rel="noopener">tls</a> 更具优势，但支持 Shadowsocks-libev 的 tls 混淆客户端较少</p>
<p>*混淆域名，使用混淆时伪装的域名，一般选择大型企业、流量出入较大、CDN 等未被墙的域名作为混淆域名 （如伪装的特定端口下的 IP 或域名来免流），常用的混淆域名有这些</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cloudfront.com</span><br><span class="line">cloudflare.com</span><br><span class="line">itunes.apple.com</span><br><span class="line">www.icloud.com</span><br><span class="line">s.mzstatic.com</span><br><span class="line">ajax.microsoft.com</span><br><span class="line">apps.bdimg.com</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ol>
<li><p><strong><a href="https://en.wikipedia.org/wiki/TCP_Fast_Open" title="TCP Fast Open" target="_blank" rel="noopener">TCP Fast Open</a></strong></p>
<p>主要通过第一次 TCP 握手后服务器产生 Cookie 作为后续 TCP 连接的认证信息，客户端通过 TCP 再次连接到服务器时，可以在 SYN 报文携带数据 （<a href="https://tools.ietf.org/html/rfc793" title="RFC793" target="_blank" rel="noopener">RFC793</a>），降低了握手频率，可避免恶意攻击并大幅降低网络延迟 （<a href="http://conferences.sigcomm.org/co-next/2011/papers/1569470463.pdf" title="参考" target="_blank" rel="noopener">参考</a>）。下面介绍如何开启这一功能</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"net.ipv4.tcp_fastopen = 3"</span> &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="comment"># 运行以上命令，设置 IPv4 下的 TFO 默认为开启状态</span></span><br><span class="line">sysctl -e -p</span><br><span class="line"><span class="comment"># 运行以上命令，应用配置</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>改善 <a href="https://en.wikipedia.org/wiki/TCP_congestion_control" title="TCP 拥塞算法" target="_blank" rel="noopener">TCP 拥塞算法</a></strong></p>
<p>HTTP 协议在传输层使用 TCP 协议，TCP 丢包重传机制算法的不同会大幅影响科学上网速度；更换 TCP 拥塞算法需要使用命令 <code>vim /etc/sysctl.conf</code> 编辑系统配置文件，并定位到 <code>net.ipv4.tcp_congestion_control =</code>  这一行 (若没有请手动添加)，其后接的算法主要有 <code>cubic</code>、<code>hybla</code>、<code>bbr</code> 等，修改完成后使用命令 <code>sysctl -e -p</code> 应用配置；下面是相关算法的简单介绍</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cubic  <span class="comment"># 由 bic 算法衍化而来，适用于低丢包率网络</span></span><br><span class="line">hybla  <span class="comment"># 卫星链路使用的算法，适用于高延迟，高丢包率的网络</span></span><br><span class="line">bbr    <span class="comment"># 由 Google 开源的算法，适用于低延迟，较低丢包率的网络 （需要手动配置*）</span></span><br></pre></td></tr></table></figure>

<p><strong>*配置 <a href="https://github.com/google/bbr" title="Google BBR" target="_blank" rel="noopener">Google BBR</a></strong></p>
<p>开始配置 BBR 之前，确保你的<strong>内核版本 &gt; 4.8.x</strong> （使用命令 <code>uname -a</code> 查看），若低于最低版本，请先<strong>更新你的内核 （Ubuntu）</strong>；若要更新内核，请先使用命令 <code>vim updatekernel.sh</code> 新建脚本，将下面的代码复制粘贴到脚本内并保存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">KERNELVER=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/ | awk -F'\"v' '/v[4-9]./&#123;print $2&#125;' | cut -d/ -f1 | grep -v -  | sort -V | tail -1)</span>"</span></span><br><span class="line"><span class="comment"># 获取最新的 Linux Kernel 版本</span></span><br><span class="line">SYSTYPE=<span class="string">"<span class="variable">$(dpkg --print-architecture)</span>"</span></span><br><span class="line"><span class="comment"># 获取系统平台信息</span></span><br><span class="line">[ <span class="string">"<span class="variable">$SYSTYPE</span>"</span> = <span class="string">"amd64"</span> ] &amp;&amp; KERNEL=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/v$&#123;KERNELVER&#125;/ | grep "linux-image" | grep "generic" | awk -F'\"&gt;' '/amd64.deb/&#123;print $2&#125;' | cut -d'&lt;' -f1 | head -1)</span>"</span></span><br><span class="line">[ <span class="string">"<span class="variable">$SYSTYPE</span>"</span> = <span class="string">"i386"</span> ] &amp;&amp; KERNEL=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/v$&#123;KERNELVER&#125;/ | grep "linux-image" | grep "generic" | awk -F'\"&gt;' '/i386.deb/&#123;print $2&#125;' | cut -d'&lt;' -f1 | head -1)</span>"</span></span><br><span class="line">[ <span class="string">"<span class="variable">$SYSTYPE</span>"</span> = <span class="string">"armhf"</span> ] &amp;&amp; KERNEL=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/v$&#123;KERNELVER&#125;/ | grep "linux-image" | grep "generic" | awk -F'\"&gt;' '/armhf.deb/&#123;print $2&#125;' | cut -d'&lt;' -f1 | head -1)</span>"</span></span><br><span class="line">[ <span class="string">"<span class="variable">$SYSTYPE</span>"</span> = <span class="string">"arm64"</span> ] &amp;&amp; KERNEL=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/v$&#123;KERNELVER&#125;/ | grep "linux-image" | grep "generic" | awk -F'\"&gt;' '/arm64.deb/&#123;print $2&#125;' | cut -d'&lt;' -f1 | head -1)</span>"</span></span><br><span class="line">[ <span class="string">"<span class="variable">$SYSTYPE</span>"</span> = <span class="string">"ppc64el"</span> ] &amp;&amp; KERNEL=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/v$&#123;KERNELVER&#125;/ | grep "linux-image" | grep "generic" | awk -F'\"&gt;' '/ppc64el.deb/&#123;print $2&#125;' | cut -d'&lt;' -f1 | head -1)</span>"</span></span><br><span class="line">[ <span class="string">"<span class="variable">$SYSTYPE</span>"</span> = <span class="string">"s390x"</span> ] &amp;&amp; KERNEL=<span class="string">"<span class="variable">$(wget -qO- http://kernel.ubuntu.com/~kernel-ppa/mainline/v$&#123;KERNELVER&#125;/ | grep "linux-image" | grep "generic" | awk -F'\"&gt;' '/s390x.deb/&#123;print $2&#125;' | cut -d'&lt;' -f1 | head -1)</span>"</span></span><br><span class="line"><span class="comment"># 获取对应平台 Kernel 包的文件名</span></span><br><span class="line">wget -t 3 -T 30 -nv -O <span class="string">"<span class="variable">$KERNEL</span>"</span> <span class="string">"http://kernel.ubuntu.com/~kernel-ppa/mainline/v<span class="variable">$&#123;KERNELVER&#125;</span>/<span class="variable">$&#123;KERNEL&#125;</span>"</span></span><br><span class="line"><span class="comment"># 下载对应的 Kernel</span></span><br><span class="line">dpkg -i <span class="variable">$KERNEL</span></span><br><span class="line"><span class="comment"># 安装下载好的 Kernel</span></span><br><span class="line">rm -f <span class="variable">$KERNEL</span></span><br><span class="line"><span class="comment"># 清理下载文件</span></span><br><span class="line">update-grub</span><br><span class="line"><span class="comment"># 更新启动菜单</span></span><br></pre></td></tr></table></figure>

<p>然后使用命令 <code>chmod -x updatekernel.sh &amp;&amp; bash updatekernel.sh</code> 给予脚本运行权限并运行脚本来更新内核</p>
<p>若无需更新内核，则先将拥塞控制算法填写为 <code>bbr</code>，再添加以下代码保存并使用命令 <code>sysctl -e -p</code> 应用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net.core.default_qdisc = fq</span><br><span class="line"><span class="comment"># 将网络拥塞队列算法设置为性能和延迟最佳的 fq_codel</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>内核优化</strong></p>
<p>使用命令 <code>vim sysctl.conf</code> 编辑并在末尾加入如下代码，对系统进程及内存分配进行优化，保存并使用命令 <code>sysctl -e -p</code> 应用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fs.file-max = 1024000</span><br><span class="line"><span class="comment"># 系统所有进程一共可以打开的句柄数 (bytes)</span></span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line"><span class="comment"># 进程通讯消息队列的最大字节数 (bytes)</span></span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line"><span class="comment"># 进程通讯消息队列单条数据最大的长度 (bytes)</span></span><br><span class="line">kernel.shmmax = 68719476736</span><br><span class="line"><span class="comment"># 内核允许的最大共享内存大小 (bytes)</span></span><br><span class="line">kernel.shmall = 4294967296</span><br><span class="line"><span class="comment"># 任意时间内系统可以使用的共享内存总量 (bytes)</span></span><br></pre></td></tr></table></figure>

<p>使用命令 <code>vim /etc/security/limits.conf</code> 编辑和写入如下代码，限制用户档案的体积大小，提高系统稳定性，完成后保存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*                soft    nofile           512000</span><br><span class="line"><span class="comment"># 用户档案警告体积大小 (bytes)</span></span><br><span class="line">*                hard    nofile          1024000</span><br><span class="line"><span class="comment"># 用户档案最大体积大小 (bytes)</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>TCP 的优化</strong></p>
<p>涉及内核控制，TCP 包大小，TCP 转发，连接超时等优化，代码的简单释义已在其下方注明；使用命令 <code>vim sysctl.conf</code> 编辑并写入如下代码，保存并使用命令 <code>sysctl -e -p</code> 应用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">net.core.rmem_max = 12582912</span><br><span class="line"><span class="comment"># 设置内核接收 Socket 的最大长度 (bytes)</span></span><br><span class="line">net.core.wmem_max = 12582912</span><br><span class="line"><span class="comment"># 设置内核发送 Socket 的最大长度 (bytes)</span></span><br><span class="line">net.ipv4.tcp_rmem = 10240 87380 12582912</span><br><span class="line"><span class="comment"># 设置 TCP Socket 接收长度的最小值，预留值，最大值 (bytes)</span></span><br><span class="line">net.ipv4.tcp_wmem = 10240 87380 12582912</span><br><span class="line"><span class="comment"># 设置 TCP Socket 发送长度的最小值，预留值，最大值 (bytes)</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br><span class="line"><span class="comment"># 开启所有网络设备的 IPv4 流量转发，用于支持 IPv4 的正常访问</span></span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line"><span class="comment"># 开启 SYN Cookie，用于防范 SYN 队列溢出后可能收到的攻击</span></span><br><span class="line">net.ipv4.tcp_tw_reuse = 1</span><br><span class="line"><span class="comment"># 允许将等待中的 Socket 重新用于新的 TCP 连接，提高 TCP 性能</span></span><br><span class="line">net.ipv4.tcp_tw_recycle = 0</span><br><span class="line"><span class="comment"># 禁止将等待中的 Socket 快速回收，提高 TCP 的稳定性</span></span><br><span class="line">net.ipv4.tcp_fin_timeout = 30</span><br><span class="line"><span class="comment"># 设置客户端断开 Sockets 连接后 TCP 在 FIN 等待状态的实际 (s)，保证性能</span></span><br><span class="line">net.ipv4.tcp_keepalive_time = 1200</span><br><span class="line"><span class="comment"># 设置 TCP 发送 keepalive 数据包的频率，影响 TCP 链接保留时间 (s)，保证性能</span></span><br><span class="line">net.ipv4.tcp_mtu_probing = 1</span><br><span class="line"><span class="comment"># 开启 TCP 层的 MTU 主动探测，提高网络速度</span></span><br><span class="line">net.ipv4.conf.all.accept_source_route = 1</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 1</span><br><span class="line"><span class="comment"># 允许接收 IPv4 环境下带有路由信息的数据包，保证安全性</span></span><br><span class="line">net.ipv4.conf.all.accept_redirects = 0</span><br><span class="line">net.ipv4.conf.default.accept_redirects = 0</span><br><span class="line"><span class="comment"># 拒绝接收来自 IPv4 的 ICMP 重定向消息，保证安全性</span></span><br><span class="line">net.ipv4.conf.all.send_redirects = 0</span><br><span class="line">net.ipv4.conf.default.send_redirects = 0</span><br><span class="line">net.ipv4.conf.lo.send_redirects = 0</span><br><span class="line"><span class="comment"># 禁止发送在 IPv4 下的 ICMP 重定向消息，保证安全性</span></span><br><span class="line">net.ipv4.conf.all.rp_filter = 0</span><br><span class="line">net.ipv4.conf.default.rp_filter = 0</span><br><span class="line">net.ipv4.conf.lo.rp_filter = 0</span><br><span class="line"><span class="comment"># 关闭反向路径回溯进行源地址验证 (RFC1812)，提高性能</span></span><br><span class="line">net.ipv4.icmp_echo_ignore_broadcasts = 1</span><br><span class="line"><span class="comment"># 忽略所有 ICMP ECHO 请求的广播，保证安全性</span></span><br><span class="line">net.ipv4.icmp_ignore_bogus_error_responses = 1</span><br><span class="line"><span class="comment"># 忽略违背 RFC1122 标准的伪造广播帧，保证安全性</span></span><br><span class="line">net.ipv6.conf.all.accept_source_route = 1</span><br><span class="line">net.ipv6.conf.default.accept_source_route = 1</span><br><span class="line"><span class="comment"># 允许接收 IPv6 环境下带有路由信息的数据包，保证安全性</span></span><br><span class="line">net.ipv6.conf.all.accept_redirects = 0</span><br><span class="line">net.ipv6.conf.default.accept_redirects = 0</span><br><span class="line"><span class="comment"># 禁止接收来自 IPv6 下的 ICMPv6 重定向消息，保证安全性</span></span><br><span class="line">net.ipv6.conf.all.autoconf = 1</span><br><span class="line"><span class="comment"># 开启自动设定本地连接地址，用于支持 IPv6 地址的正常分配</span></span><br><span class="line">net.ipv6.conf.all.forwarding = 1</span><br><span class="line"><span class="comment"># 开启所有网络设备的 IPv6 流量转发，用于支持 IPv6 的正常访问</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用 <a href="https://gitlab.com/m2crypto/m2crypto" title="m2crypto" target="_blank" rel="noopener">m2crypto</a> 加速加解密 （Python 服务端）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get install build-essential python3-dev python-dev python-pip libssl-dev swig</span><br><span class="line"><span class="comment"># 运行以上命令，安装支持库</span></span><br><span class="line">pip install m2crypto</span><br><span class="line"><span class="comment"># 运行以上命令，安装 m2crypto</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用 <a href="https://github.com/shadowsocks/kcptun" title="Kcptun" target="_blank" rel="noopener">Kcptun</a> 加速 （会影响 TCP Fast Open 的正常工作，请自行取舍）</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$(dpkg --print-architecture)</span>"</span></span><br><span class="line"><span class="comment"># 运行以上命令，查看 Linux 硬件版本</span></span><br></pre></td></tr></table></figure>

<p>在<strong><a href="https://github.com/shadowsocks/kcptun" title="这里" target="_blank" rel="noopener">这里</a></strong>获取最新的预编译版本 Kcptun (Go) 下载地址 （注意选择相应的 Linux 系统版本）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">wget [获取的下载地址]</span><br><span class="line"><span class="comment"># 运行以上命令，下载预编译版本 Kcptun</span></span><br><span class="line">tar -zxvf [下载后的文件名]</span><br><span class="line"><span class="comment"># 运行以上命令，解压预编译文件</span></span><br><span class="line">./[解压后的文件名] -t <span class="string">"[服务器目标IPv4]:[Kcptun目标端口]"</span> -l <span class="string">":[Kcptun监听端口]"</span></span><br><span class="line"><span class="comment"># 运行以上命令启动 Kcptun，具体配置请参考官方 README*</span></span><br></pre></td></tr></table></figure>

<p>*<a href="https://github.com/shadowsocks/kcptun/blob/shadowsocks/README.en.md" title="kcptun/README" target="_blank" rel="noopener">kcptun/README</a> 官方文档</p>
</li>
</ol>
<h3 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h3><ol>
<li><p><strong>Web Server 的伪装 （使用 TCP80 或TCP 443 为端口的 Shadowsocks 服务器效果更佳）</strong></p>
<p>可以使用 <a href="https://en.m.wikipedia.org/wiki/Apache_HTTP_Server" title="Apache" target="_blank" rel="noopener">Apache</a> 来构建一个网站服务器，用于隐藏 Shadowsocks 服务器的特征，防止 Shadowsocks 服务器被运营商或防火墙的主动探测发现；使用以下命令配置 Apache 服务器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install apache2</span><br><span class="line"><span class="comment"># 运行以上命令，安装 Apache 服务</span></span><br><span class="line">service apache2 start</span><br><span class="line"><span class="comment"># 运行以上命令，启动 Apache 服务*</span></span><br></pre></td></tr></table></figure>

<p>*若在 TCP80 端口开放或 Shadowsocks 已经连接的状况下在浏览器中输入服务器的 IP 并访问，出现 <code>It’s works!</code> 即为成功配置 Apache Server ；关于安全性加强，请参考②封禁恶意访问 IP</p>
<p>*究其根本，使用较新的 AEAD 流加密更加有效，以上方法仅在某种层面具有一定的效果</p>
</li>
<li><p><strong>封禁恶意访问 IP</strong></p>
<p>使用 <a href="https://en.m.wikipedia.org/wiki/Fail2ban" title="fail2ban" target="_blank" rel="noopener">fail2ban</a> 来阻止恶意的 SSH 和 Apache Web Server 攻击者，主要是解决潜在的用户攻击者 （比如那些有权限连接到你的 Shadowsocks 服务器的设备可能会绕开实例的外部防火墙，因此单纯配置 Firewall 并不是完全有用的）；首先使用以下命令安装 fail2ban</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install fail2ban</span><br><span class="line"><span class="comment"># 运行以上命令，安装 fail2ban</span></span><br></pre></td></tr></table></figure>

<p>使用命令 <code>vim /etc/fail2ban/jail.local</code> 按情况添加以下部分代码并保存来配置 fail2ban 规则，首先是 SSH 规则代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ssh-iptables]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">filter     = sshd</span><br><span class="line">action   = iptables[name=SSH, port=ssh, protocol=tcp]</span><br><span class="line">logpath = /var/<span class="built_in">log</span>/auth.log</span><br></pre></td></tr></table></figure>

<p>*若开启了 Apache Web Server 伪装，还须添加如下代码保证 Web Server 的安全</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[apache-tcpwrapper]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">filter     = apache-auth</span><br><span class="line">action   = hostdeny</span><br><span class="line">logpath = /var/<span class="built_in">log</span>/httpd/error_log</span><br><span class="line">	</span><br><span class="line"> [apache-badbots]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">filter     = apache-badbots</span><br><span class="line">action   = iptables-multiport[name=BadBots, pory=<span class="string">"http,https"</span>]</span><br><span class="line">logpath = /var/<span class="built_in">log</span>/httpd/access_log</span><br><span class="line">	</span><br><span class="line"> [apache-shorewall]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line">filter     = apache-noscript</span><br><span class="line">action   = shorewall</span><br><span class="line">logpath = /var/<span class="built_in">log</span>/httpd/error_log</span><br></pre></td></tr></table></figure>

<p>使用 Shadowsocks 或 ShadowsocksR 自带的 <a href="https://github.com/shadowsocks/shadowsocks/wiki/Ban-Brute-Force-Crackers" title="autoban.py" target="_blank" rel="noopener">autoban.py</a> 来禁止恶意的 Shadowsocks 攻击 （仅限 <a href="https://en.m.wikipedia.org/wiki/Python_(programming_language" target="_blank" rel="noopener">Python</a> 服务端，开始前请确保你拥有 Python 环境）；首先找到你的 Shadowsocks(R) 安装路径，请使用命令 <code>cd</code> 进入目录和 <code>ls</code> 显示目录下文件或其它方式找到其<strong>安装路径</strong>，并按照如下步骤安装 <a href="https://github.com/Supervisor/supervisor" title="Supervisor" target="_blank" rel="noopener">Supervisor</a> （用于运行 Autoban）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get -y install supervisor</span><br><span class="line"><span class="comment"># 安装 Supervisor 任务管理，用于后台运行 autoban.py</span></span><br></pre></td></tr></table></figure>

<p>使用命令 <code>vim /etc/supervisor/conf.d/autoban.conf</code> 创建 supervisor 配置文件，输入如下代码并保存</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[program:autoban]</span><br><span class="line"><span class="built_in">command</span>=python autoban.py &lt; /var/<span class="built_in">log</span>/shadowsocks.log</span><br><span class="line">directory=[Shadowsocks(R) 安装路径]/utils</span><br><span class="line">autorestart=<span class="literal">true</span></span><br><span class="line">user=root</span><br></pre></td></tr></table></figure>

<p>使用如下命令启动 Supervisor 及 Autoban （关于 Autoban 的更多信息请参考<a href="https://github.com/shadowsocks/shadowsocks/wiki/Ban-Brute-Force-Crackers" title="这里" target="_blank" rel="noopener"><strong>这里</strong></a>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service supervisor start</span><br><span class="line"><span class="comment"># 运行以上命令，启动 Supervisor 服务</span></span><br><span class="line">supervisorctl reload</span><br><span class="line"><span class="comment"># 运行以上命令，重加载 Autoban 计划</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="客户端的选择"><a href="#客户端的选择" class="headerlink" title="客户端的选择"></a>客户端的选择</h2><p><strong>以下主要介绍各个平台的 GUI Based 客户端，仅供参考</strong> （Simple-Obfs 为 Shadowsocks-libev 的混淆标准，不支持 Simple-Obfs 并不意味着不支持 ShadowsocksR 的 Obfs-Plugin 混淆标准；此处评价仅从 Shadowsocks-libev 的角度出发，请勿误解）</p>
<h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><ul>
<li><p><strong><a href="https://github.com/shadowsocks/ShadowsocksX-NG" title="ShadowsocksX-NG" target="_blank" rel="noopener">ShadowsocksX-NG</a></strong><br>免费且功能强大的客户端，支持 AEAD，Kcptun，UDP，不支持任何混淆或 TCP Fast Open，稳定性一般</p>
</li>
<li><p><strong><a href="http://nssurge.com/" title="Surge" target="_blank" rel="noopener">Surge</a></strong><br>价格昂贵的网络调试工具，支持 AEAD，TCP Fast Open，同时支持 Simple-Obfs 的 http 混淆 （tls 适配中），稳定性极佳</p>
</li>
</ul>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><ul>
<li><p><strong><a href="https://github.com/shadowsocks/shadowsocks-windows" title="Shadowsocks-windows" target="_blank" rel="noopener">Shadowsocks-windows</a></strong><br>免费易用的官方客户端，支持 AEAD，UDP，TCP Fast Open 还在测试中，但不支持 Simple-Obfs，稳定性极佳</p>
</li>
<li><p><strong><a href="https://github.com/shadowsocks/shadowsocks-qt5" title="Shadowsocks-qt5" target="_blank" rel="noopener">Shadowsocks-qt5</a></strong><br>免费易用的跨平台客户端，但目前不支持 AEAD，TCP Fast Open 和 Simple-Obfs，稳定性一般</p>
</li>
</ul>
<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul>
<li><p><strong><a href="https://github.com/shadowsocks/shadowsocks-qt5" title="Shadowsocks-qt5" target="_blank" rel="noopener">Shadowsocks-qt5</a></strong><br>免费易用的跨平台客户端，但目前不支持 AEAD，TCP Fast Open 和 Simple-Obfs，稳定性一般</p>
</li>
<li><p><strong><a href="https://github.com/avege/avege" title="Avege" target="_blank" rel="noopener">Avege</a></strong><br>免费易用的跨平台客户端，主要适配 ShadowsocksR (与 Shadowsocks-libev 兼容)，不支持 AEAD，TCP Fast Open 和 Simple-Obfs，稳定性一般</p>
</li>
</ul>
<h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><ul>
<li><p><strong><a href="https://itunes.apple.com/us/app/shadowrocket/id932747118?mt=8&uo=4&at=10lJSw&ct=appcards" title="Shadowrocket" target="_blank" rel="noopener">Shadowrocket</a></strong><br>目前最强大的Shadowsocks (R) 付费客户端之一，支持 AEAD，ObfsPlugin，可自定义规则，稳定性一般</p>
</li>
<li><p><strong><a href="https://itunes.apple.com/us/app/potatso-2-ultimate-networking-tool/id1162704202?mt=8&uo=4&at=10lJSw&ct=appcards" title="Potatso 2" target="_blank" rel="noopener">Potatso 2</a></strong><br>方便易用的付费客户端，支持 AEAD，Obfs-Plugin，UDP可自定义规则，稳定性一般</p>
</li>
<li><p><strong><a href="https://itunes.apple.com/cn/app/surge-web-developer-tool-proxy/id1040100637?mt=8&uo=4&at=10lJSw&ct=appcards" title="Surge" target="_blank" rel="noopener">Surge</a></strong><br>昂贵的网络调试工具，支持 AEAD，TCP Fast Open，Simple-Obfs，MitM 可自定义规则，稳定性极佳</p>
</li>
</ul>
<h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><ul>
<li><strong><a href="https://play.google.com/store/apps/details?id=com.github.shadowsocks&hl=zh_CN&uo=4&ct=appcards" title="Shadowsocks" target="_blank" rel="noopener">Shadowsocks</a></strong><br>免费开源的官方客户端，支持 AEAD，TCP Fast Open，Simple-Obfs，Kcptun，UDP，TCP Fast Open (需要 root 权限)，功能十分全面，但稳定性一般</li>
</ul>
<h3 id="OpenWRT"><a href="#OpenWRT" class="headerlink" title="OpenWRT"></a>OpenWRT</h3><ul>
<li><strong><a href="https://github.com/shadowsocks/openwrt-shadowsocks" title="OpenWRT-Shadowsocks" target="_blank" rel="noopener">OpenWRT-Shadowsocks</a></strong><br>开源的官方客户端，支持 AEAD，TCP Fast Open，Simple-Obfs，UDP；<strong>配合 <a href="https://github.com/shadowsocks/ChinaDNS" title="ChinaDNS" target="_blank" rel="noopener">ChinaDNS</a> 和 <a href="https://github.com/shadowsocks/luci-app-shadowsocks" title="luci-app-shadowsocks" target="_blank" rel="noopener">luci-app-shadowsocks</a> (GUI) 使用 （官方 <a href="https://github.com/shadowsocks/luci-app-shadowsocks/wiki" title="Wiki" target="_blank" rel="noopener">Wiki</a>）</strong>，稳定性一般。其中 ChinaDNS，luci-app-shadowsocks 一般可直接在路由器 <em><em>管理界面&gt;软件 （Software） *</em>中安装，后者依赖两个包 <code>iptables</code>  和  <code>ipset</code>；若有 Shadowsocks-libev 缺失情况，可参照命令安装</em></li>
</ul>
<p>*命令安装</p>
<p>在<strong><a href="https://github.com/shadowsocks/luci-app-shadowsocks" title="这里" target="_blank" rel="noopener">这里</a></strong>获取最新预编译 <code>.ipk</code> 地址，使用 <a href="https://en.wikipedia.org/wiki/Telnet" title="Telnet" target="_blank" rel="noopener">Telnet</a> 或 SSH 连接到你的路由，使用以下命令进行安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">opkg install wget</span><br><span class="line"># 运行以上命令安装 wget 服务，用于下载 .ipk 到路由器</span><br><span class="line">wget [获取的.ipk地址]</span><br><span class="line"># 运行以上命令下载 .ipk 到路由；下载前应注意路由器 CPU 型号，确保选择了正确的 .ipk</span><br><span class="line">dpkg -i [下载后的.ipk路径或名称]</span><br><span class="line"># 运行以上命令安装客户端</span><br></pre></td></tr></table></figure>

<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>引用一句 <a href="https://github.com/clowwindy" title="clowwindy" target="_blank" rel="noopener">clowwindy</a> 的话：</p>
<blockquote>
<p>往往不需要政府造墙，网民也会自发造墙</p>
</blockquote>

      </div>
      
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="prev" href="/2017/09/12/bbr/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">一键安装最新内核并开启 BBR 脚本</span>
        <span class="prev-text nav-mobile">上一篇</span>
      </a>
    <a class="next" href="/2017/09/08/shadowrocket-manual/">
        <span class="next-text nav-default">Shadowrocket（小火箭）使用简单说明</span>
        <span class="prev-text nav-mobile">下一篇</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"><div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    </div></div>
      </main>

      <footer id="footer" class="footer"><div class="social-links"><a href="https://github.com/AppSo" class="iconfont icon-github" title="github"></a>
        </div><div class="copyright">
  <span class="copyright-year">&copy;2017 - 2019<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">AppSo</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2017/09/11/breakwall/';
        this.page.identifier = '2017/09/11/breakwall/';
        this.page.title = '翻墙小结';
    };
    (function() {
    var d = document, s = d.createElement('script');

    s.src = '//appso.disqus.com/embed.js';

    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();  
  </script><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/lib/pjax/jquery.pjax.min.js"></script>
  <script type="text/javascript" src="/lib/nprogress/nprogress.min.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v=2.11.0"></script>
</body>
</html>
